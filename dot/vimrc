set nocompatible

syntax enable

filetype on
filetype off
set rtp+=~/.vim/bundle/vundle
call vundle#rc()

Bundle 'gmarik/vundle'
Bundle 'tpope/vim-surround'
Bundle 'tpope/vim-repeat'
Bundle 'tpope/vim-commentary'
Bundle 'tpope/vim-unimpaired'
Bundle 'tpope/vim-abolish'
Bundle 'kana/vim-textobj-user'
Bundle 'kana/vim-textobj-indent'
Bundle 'altercation/vim-colors-solarized'
Bundle 'scrooloose/syntastic'
Bundle 'hynek/vim-python-pep8-indent'
Bundle 'vivien/vim-addon-linux-coding-style'
Bundle 'christoomey/vim-tmux-navigator'

filetype plugin indent on
syntax on
color solarized

set autoindent
set autoread
set backspace=indent,eol,start
set clipboard=unnamed
set laststatus=1 ruler showcmd
set completeopt=menu,longest
set encoding=utf-8
set ignorecase incsearch hlsearch smartcase
set hidden
set history=1000
set scrolloff=3
set shortmess+=filmnrxoOtT
set expandtab shiftwidth=2 softtabstop=2 tabstop=8
set wildignore+=*/tmp/*,*.so,*.swp,*.zip wildmenu wildmode=list:longest,full
set whichwrap=b,s,h,l,<,>,[,]
set mouse=a mousehide
set noerrorbells visualbell t_vb=
set backup
if has('persistent_undo')
  set undofile undolevels=1000 undoreload=10000
endif

map <c-h> <c-w>h
map <c-j> <c-w>j
map <c-k> <c-w>k
map <c-l> <c-w>l
map <s-h> gT
map <s-l> gt
noremap j gj
noremap k gk
nnoremap Y y$
vnoremap < <gv
vnoremap > >gv
map zl zL
map zh zH
map <silent> <c-_> :nohlsearch<cr>  " <c-_> maps to <c-/>
cmap cwd lcd %:p:h
cmap cd. lcd %:p:h
cmap w!! w !sudo tee % >/dev/null

runtime ftplugin/man.vim
nnoremap K :<c-u>exe "Man" v:count "<c-r><c-w>"<cr>

autocmd BufRead,BufNewFile *.md setlocal filetype=markdown spell
autocmd VimResized * :wincmd =
autocmd BufWritePre <buffer> call StripTrailingWhitespace()
autocmd BufWinEnter,WinEnter * let w:m2=matchadd('ColorColumn', '\%>79v.\+', -1)
autocmd BufEnter * if bufname("") !~ "^\[A-Za-z0-9\]*://" | lcd %:p:h | endif
autocmd FileType gitcommit au! BufEnter COMMIT_EDITMSG call setpos('.', [0, 1, 1, 0])

augroup restoreCursor
  autocmd!
  autocmd BufWinEnter * call RestoreCursor()
augroup END

function! InitializeDirectories()
  let parent = $HOME
  let prefix = 'vim/'
  let dir_list = {
        \ 'backup': 'backupdir',
        \ 'views': 'viewdir',
        \ 'swap': 'directory' }
  if has('persistent_undo')
    let dir_list['undo'] = 'undodir'
  endif
  let common_dir = parent . '/.' . prefix
  for [dirname, settingname] in items(dir_list)
    let directory = common_dir . dirname . '/'
    if exists("*mkdir")
      if !isdirectory(directory)
        call mkdir(directory)
      endif
    endif
    if !isdirectory(directory)
      echo "Warning: Unable to create backup directory: " . directory
      echo "Try: mkdir -p " . directory
    else
      let directory = substitute(directory, " ", "\\\\ ", "g")
      exec "set " . settingname . "=" . directory
    endif
  endfor
endfunction
call InitializeDirectories()

function! StripTrailingWhitespace()
  " Preparation: save last search, and cursor position.
  let _s=@/
  let l = line(".")
  let c = col(".")
  " Let's do this!
  %s/\s\+$//e
  " Clean up: restore previous search history, and cursor position
  let @/=_s
  call cursor(l, c)
endfunction

function! RestoreCursor()
  if line("'\"") <= line("$")
    normal! g`"
    return 1
  endif
endfunction
